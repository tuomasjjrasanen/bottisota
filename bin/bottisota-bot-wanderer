#!/usr/bin/env python3

import bottisota
import bottisota.math
import bottisota.bus

def move_to(botconn, destination):
    while True:
        x, y, speed, direction = botconn.syscall_pos()
        loc = x, y

        distance_to_destination = bottisota.math.distance(loc, destination)

        direction = bottisota.math.direction(loc, destination)

        if distance_to_destination < 5:
            return

        if distance_to_destination < 5 * speed:
            # We are getting closer, slow down.
            speed = max(speed // 2, 1)
        else:
            # Full speed ahead.
            speed = bottisota.DRV_SPEED_MAX

        botconn.syscall_drv(direction, speed)

botconn = bottisota.bus.BotConnection()

botconn.syscall_clk()
while True:
    move_to(botconn, bottisota.math.randloc())
