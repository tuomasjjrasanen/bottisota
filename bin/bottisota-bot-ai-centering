#!/usr/bin/env python3

import bottisota
import bottisota.bus
import bottisota.math

botconn = bottisota.bus.BotConnection()

botconn.sys_clk()

center = (bottisota.X_MAX // 2, bottisota.Y_MAX // 2)

while True:
    err, x, y, speed, direction = botconn.sys_pos()
    loc = x, y

    center_distance = bottisota.math.distance(loc, center)

    direction = bottisota.math.direction(loc, center)

    if center_distance < 3:
        # Close enough, stop.
        new_speed = 0
    elif center_distance < 3 * speed:
        # We are getting closer, slow down.
        new_speed = max(speed // 2, 1)
    else:
        # Full speed ahead.
        new_speed = 20

    botconn.sys_drv(new_speed, direction)

botconn.disconnect()
